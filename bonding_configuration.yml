---
- name: Bonding Configuration
  hosts: sai-ansiblesrv, sai-client1, sai-client2
  remote_user: ansadmin
  become: true
  vars:
       - nmcli_bond:
            - {conn_name: 'bond0', ip4: "192.168.29.147/24", gw4: "192.168.29.1", mode: 'active-backup'}

       - nmcli_bond_slave:
            - {conn_name: 'ens38', ifname: 'ens38', master: 'bond0'}
            - {conn_name: 'ens39', ifname: 'ens39', master: 'bond0'}

  tasks:
        -  name: bonding active backup configuration
           nmcli:
                 type: bond
                 conn_name: '{{item.conn_name}}'
                 ip4: '{{item.ip4}}'
                 gw4: '{{item.gw4}}'
                 mode: '{{item.mode}}'
                 state: present
           with_items:
                      - '{{nmcli_bond}}'
        -  name: bond slave configuration
           nmcli:
                 type: bond-slave
                 conn_name: '{{item.conn_name}}'
                 ifname: '{{item.ifname}}'
                 master: '{{item.master}}'
                 state: present
           with_items:
                      - '{{nmcli_bond_slave}}'

